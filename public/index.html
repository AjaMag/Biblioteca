<!DOCTYPE html>
<html lang="en">

<head>
  <!-- we might need to use a class="no-js" in the <html> tag to prevent a 
"flash of unstyled content" for many Foundation components. -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <!-- Applicaiton style -->
  <link rel="stylesheet" href="../style.css">

  <title>Biblioteca</title>
</head>

<body>

  <!-- Dropdown Structure -->
  <div class="container">

    <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo">

          <img src="../public/images/librarylogo2.jpg" width="40%">

        </a>
        <ul id="nav-mobile" class="right ">
          <li><a href="/">Home</a></li>
          <li><a href="/libraryadmin">Admin</a></li>

        </ul>
      </div>
    </nav>

    <div class="searchBar">
      <div class="row">
        <div class="input-field col s16 ">
          <select class="browser-default" id="sectionList" onclick="selectChange()">
            <!-- <option value="0">Option 0</option>
                <option value="1">Option 1</option>
                <option value="2">Option 2</option>
                <option value="3">Option 3</option> -->
          </select>
        </div>
        <div class='col s6'>
          <!-- nothing here -->
        </div>
      </div>

    </div>


    <!-- <div class="container"> -->
      <div class="row">
        <div class="col s12">
          <a class="waves-effect waves-light btn"><i class="material-icons left">search</i>Search</a>
          <a class="waves-effect waves-light btn"><i class="material-icons left">layers_clear</i>Clear Search</a>
          <a class="waves-effect waves-light btn"><i class="material-icons left">list</i>Total Items </a>
          <a class="waves-effect waves-light btn"><i class="material-icons left">shopping_cart</i>View Cart</a>
        </div>
      </div>

      <!-- <div class="row">

        <div class="col s6">
          <div class="container">

            <nav class="white">
              <div class="nav-wrapper">
                <ul class="hide-on-med-and-down right">
                  <li>
                    <div class="center row">
                      <div class="col s12 ">
                        <div class="row" id="topbarsearch">
                          <div class="input-field col s6 s12 white-text">
                            <input type="text" placeholder="search" id="autocomplete-input" class="autocomplete white-text">
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </nav>

          </div>


        </div>
        <div class="col s6">
          <div class="row">
            <div class="col s12 m6">
              <div class="card">
                <div class="card-image">
                  <img src="images/sample-1.jpg">
                  <span class="card-title">Card Title</span>
                  <a class="btn-floating halfway-fab waves-effect waves-light red"><i class="material-icons">add</i></a>
                </div>
                <div class="card-content">
                  <p>I am a very simple card. I am good at containing small bits of information. I am convenient
                    because I require little markup to use effectively.</p>
                </div>
              </div>
            </div>
          </div>


        </div>
      </div> -->


    <!-- </div> -->

    <div class="container">
      <ul id="bookList">
        <!-- Library sections will go here -->
      </ul>
    </div>



    <!-- Compressed JavaScript for Foundation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="../app.js"></script>

    <script>
      // keep a collection of incoming departments
      let sectionArr = []
  

      document.addEventListener('click', e => {
      if (e.target && e.target.id === 'addCart') {
        //  redirect to the link (how to pass a parameter on new location? )
        // window.location = `./booksadmin-edit?id=${e.target.value}`

        // TODO: somethng goes here
      }

    })

      const getLibarySections = () => {
        fetch('/librarysections')
          .then(r => r.json())
          .then(r => {
            document.querySelector('#sectionList').innerHTML = ''

            // All sections
            let listOption = document.createElement('option')
            listOption.innerHTML = `<option value="all">All Sections</option>`
            document.querySelector('#sectionList').appendChild(listOption)

            r.forEach(libSect => {
              // add sections to array
              sectionArr.push({
                id: libSect.id,
                description: libSect.description,
                location: libSect.location
              })
              // add department name to selector
              let listOption = document.createElement('option')
              listOption.innerHTML = `<option value="${libSect.id}">${libSect.description}</option>`
              document.querySelector('#sectionList').appendChild(listOption)
            });
          })
          .catch(e => console.error(e))
      }

      const getBooks = () => {

        fetch(`/librarybooks`)
          .then(r => r.json())
          .then(r => {
            document.querySelector('#bookList').innerHTML = ''
            r.forEach(book => {
              let listItem = document.createElement('li')
              listItem.innerHTML =
                ` <div class="row">
                 <div class="col s9">                             
                    <div class="card blue-grey darken-1">
                     <div class="card-content white-text">
                        <span class="card-title">Title: ${book.title}</span>
                        <p>Author: ${book.author}</p>
                        <p> Year: ${book.year} Genre: ${book.genre} ISBN: ${book.ISBN}</p>           
                        <p> Summary: ${book.summary}</p>
                        <p> Stock Qty: ${book.stockQty}</p>
                        <p> Section: ${book.section.description} ( Location: ${book.section.location} )</p>
                    </div>
                   </div>
                 </div>
                 <div class="col s3">
                    <button id="addCart" class="btn btn-primary" value=${book.id}>Add to Cart</button>
                 </div>
            </div>
            `
              document.querySelector('#bookList').appendChild(listItem)
            });
          })
          .catch(e => console.error(e))
      }

      const getBooksBySection = (sectionId) => {

        fetch(`/librarybooks-section/${sectionId}`)
          .then(r => r.json())
          .then(r => {
            document.querySelector('#bookList').innerHTML = ''
            r.forEach(book => {
              let listItem = document.createElement('li')
              listItem.innerHTML =
                ` <div class="row">
                          <div class="col s9">                             
                             <div class="card blue-grey darken-1">
                              <div class="card-content white-text">
                                 <span class="card-title">Title: ${book.title}</span>
                                 <p>Author: ${book.author}</p>
                                 <p> Year: ${book.year} Genre: ${book.genre} ISBN: ${book.ISBN}</p>           
                                 <p> Summary: ${book.summary}</p>
                                 <p> Stock Qty: ${book.stockQty}</p>
                                 <p> Section: ${book.section.description} ( Location: ${book.section.location} )</p>
                             </div>
                            </div>
                          </div>
                          <div class="col s3">
                             <button id="addCart" class="btn btn-primary" value=${book.id}>Add to Cart</button>
                          </div>
                     </div>
                     `
              document.querySelector('#bookList').appendChild(listItem)
            });
          })
          .catch(e => console.error(e))

      }

      // Get selected value
      const selectChange = () => {
        if (document.querySelector('#sectionList').value === 'All Sections') {
          // get all books
          getBooks()
        } else {
          // get all books in a section 
          let sectionId = getSectionId(document.querySelector('#sectionList').value, sectionArr)
          getBooksBySection(sectionId)
        }
      }

      getLibarySections()
      getBooks()
    </script>
</body>

</html>